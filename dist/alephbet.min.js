!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.AlephBet=f()}}(function(){var define;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){(function(global){(function(){function t(t){return"function"==typeof t||!1}function r(t){return"string"==typeof t?t:null==t?"":t+""}function n(t){return!!t&&"object"==typeof t}function e(){}function o(t,r){for(var n=-1,e=t.length;++n<e&&r(t[n],n,t)!==!1;);return t}function u(t,r){return t===P?r:t}function c(t,r,n){for(var e=-1,o=xt(r),u=o.length;++e<u;){var c=o[e],l=t[c],i=n(l,r[c],c,t,r);(i===i?i===l:l!==l)&&(l!==P||c in t)||(t[c]=i)}return t}function l(t,r){return null==r?t:i(r,xt(r),t)}function i(t,r,n){n||(n={});for(var e=-1,o=r.length;++e<o;){var u=r[e];n[u]=t[u]}return n}function a(t){return function(r){return null==r?P:j(r)[t]}}function f(t,r,n){if("function"!=typeof t)return A;if(r===P)return t;switch(n){case 1:return function(n){return t.call(r,n)};case 3:return function(n,e,o){return t.call(r,n,e,o)};case 4:return function(n,e,o,u){return t.call(r,n,e,o,u)};case 5:return function(n,e,o,u,c){return t.call(r,n,e,o,u,c)}}return function(){return t.apply(r,arguments)}}function s(t){return m(function(r,n){var e=-1,o=null==r?0:n.length,u=o>2?n[o-2]:P,c=o>2?n[2]:P,l=o>1?n[o-1]:P;for("function"==typeof u?(u=f(u,l,5),o-=2):(u="function"==typeof l?l:P,o-=u?1:0),c&&h(n[0],n[1],c)&&(u=3>o?P:u,o=1);++e<o;){var i=n[e];i&&t(r,i,u)}return r})}function p(t,r){var n=null==t?P:t[r];return x(n)?n:P}function y(t){return null!=t&&b(vt(t))}function g(t,r){return t="number"==typeof t||q.test(t)?+t:-1,r=null==r?gt:r,t>-1&&t%1==0&&r>t}function h(t,r,n){if(!d(n))return!1;var e=typeof r;if("number"==e?y(n)&&g(r,n.length):"string"==e&&r in n){var o=n[r];return t===t?t===o:o!==o}return!1}function b(t){return"number"==typeof t&&t>-1&&t%1==0&&gt>=t}function v(t){for(var r=E(t),n=r.length,e=n&&t.length,o=!!e&&b(e)&&(jt(t)||O(t)||w(t)),u=-1,c=[];++u<n;){var l=r[u];(o&&g(l,e)||ut.call(t,l))&&c.push(l)}return c}function j(t){if(e.support.unindexedChars&&w(t)){for(var r=-1,n=t.length,o=Object(t);++r<n;)o[r]=t.charAt(r);return o}return d(t)?t:Object(t)}function m(t,r){if("function"!=typeof t)throw new TypeError(R);return r=yt(r===P?t.length-1:+r||0,0),function(){for(var n=arguments,e=-1,o=yt(n.length-r,0),u=Array(o);++e<o;)u[e]=n[r+e];switch(r){case 0:return t.call(this,u);case 1:return t.call(this,n[0],u);case 2:return t.call(this,n[0],n[1],u)}var c=Array(r+1);for(e=-1;++e<r;)c[e]=n[e];return c[r]=u,t.apply(this,c)}}function O(t){return n(t)&&y(t)&&ct.call(t)==T}function d(t){var r=typeof t;return!!t&&("object"==r||"function"==r)}function x(t){return null==t?!1:ct.call(t)==N?lt.test(ot.call(t)):n(t)&&(Z(t)?lt:_).test(t)}function w(t){return"string"==typeof t||n(t)&&ct.call(t)==M}function E(t){if(null==t)return[];d(t)||(t=Object(t));var r=t.length,n=e.support;r=r&&b(r)&&(jt(t)||O(t)||w(t))&&r||0;for(var o=t.constructor,u=-1,c=mt(o)&&o.prototype||nt,l=c===t,i=Array(r),a=r>0,f=n.enumErrorProps&&(t===rt||t instanceof Error),s=n.enumPrototypes&&mt(t);++u<r;)i[u]=u+"";for(var p in t)s&&"prototype"==p||f&&("message"==p||"name"==p)||a&&g(p,r)||"constructor"==p&&(l||!ut.call(t,p))||i.push(p);if(n.nonEnumShadows&&t!==nt){var y=t===et?M:t===rt?F:ct.call(t),h=ht[y]||ht[B];for(y==B&&(c=nt),r=z.length;r--;){p=z[r];var v=h[p];l&&v||(v?!ut.call(t,p):t[p]===c[p])||i.push(p)}}return i}function S(t){return t=r(t),t&&V.test(t)?t.replace(U,"\\$&"):t}function A(t){return t}var P,$="3.9.3",R="Expected a function",T="[object Arguments]",I="[object Array]",k="[object Boolean]",C="[object Date]",F="[object Error]",N="[object Function]",L="[object Number]",B="[object Object]",D="[object RegExp]",M="[object String]",U=/[.*+?^${}()|[\]\/\\]/g,V=RegExp(U.source),_=/^\[object .+?Constructor\]$/,q=/^\d+$/,z=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],G={"function":!0,object:!0},H=G[typeof exports]&&exports&&!exports.nodeType&&exports,J=G[typeof module]&&module&&!module.nodeType&&module,K=H&&J&&"object"==typeof global&&global&&global.Object&&global,Q=G[typeof self]&&self&&self.Object&&self,W=G[typeof window]&&window&&window.Object&&window,X=J&&J.exports===H&&H,Y=K||W!==(this&&this.window)&&W||Q||this,Z=function(){try{Object({toString:0}+"")}catch(t){return function(){return!1}}return function(t){return"function"!=typeof t.toString&&"string"==typeof(t+"")}}(),tt=Array.prototype,rt=Error.prototype,nt=Object.prototype,et=String.prototype,ot=Function.prototype.toString,ut=nt.hasOwnProperty,ct=nt.toString,lt=RegExp("^"+S(ot.call(ut)).replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),it=nt.propertyIsEnumerable,at=tt.splice,ft=p(Y,"Uint8Array"),st=p(Array,"isArray"),pt=p(Object,"keys"),yt=Math.max,gt=9007199254740991,ht={};ht[I]=ht[C]=ht[L]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},ht[k]=ht[M]={constructor:!0,toString:!0,valueOf:!0},ht[F]=ht[N]=ht[D]={constructor:!0,toString:!0},ht[B]={constructor:!0},o(z,function(t){for(var r in ht)if(ut.call(ht,r)){var n=ht[r];n[t]=ut.call(n,t)}});var bt=e.support={};!function(t){var r=function(){this.x=t},n={0:t,length:t},e=[];r.prototype={valueOf:t,y:t};for(var o in new r)e.push(o);bt.argsTag=ct.call(arguments)==T,bt.enumErrorProps=it.call(rt,"message")||it.call(rt,"name"),bt.enumPrototypes=it.call(r,"prototype"),bt.nonEnumShadows=!/valueOf/.test(e),bt.spliceObjects=(at.call(n,0,1),!n[0]),bt.unindexedChars="x"[0]+Object("x")[0]!="xx"}(1,0);var vt=a("length");bt.argsTag||(O=function(t){return n(t)&&y(t)&&ut.call(t,"callee")&&!it.call(t,"callee")});var jt=st||function(t){return n(t)&&b(t.length)&&ct.call(t)==I},mt=t(/x/)||ft&&!t(ft)?function(t){return ct.call(t)==N}:t,Ot=s(function(t,r,n){return n?c(t,r,n):l(t,r)}),dt=m(function(t){var r=t[0];return null==r?r:(t.push(u),Ot.apply(P,t))}),xt=pt?function(t){var r=null==t?null:t.constructor;return"function"==typeof r&&r.prototype===t||("function"==typeof t?e.support.enumPrototypes:y(t))?v(t):d(t)?pt(t):[]}:v;e.assign=Ot,e.defaults=dt,e.keys=xt,e.keysIn=E,e.restParam=m,e.extend=Ot,e.escapeRegExp=S,e.identity=A,e.isArguments=O,e.isArray=jt,e.isFunction=mt,e.isNative=x,e.isObject=d,e.isString=w,e.VERSION=$,H&&J&&X&&((J.exports=e)._=e)}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(require,module,exports){!function(e){function o(){try{return r in e&&e[r]}catch(t){return!1}}function h(e){return e.replace(/^d/,"___$&").replace(c,"___")}var s,t={},n=e.document,r="localStorage",i="script";if(t.disabled=!1,t.version="1.3.17",t.set=function(e,t){},t.get=function(e,t){},t.has=function(e){return void 0!==t.get(e)},t.remove=function(e){},t.clear=function(){},t.transact=function(e,n,r){null==r&&(r=n,n=null),null==n&&(n={});var i=t.get(e,n);r(i),t.set(e,i)},t.getAll=function(){},t.forEach=function(){},t.serialize=function(e){return JSON.stringify(e)},t.deserialize=function(e){if("string"!=typeof e)return void 0;try{return JSON.parse(e)}catch(t){return e||void 0}},o())s=e[r],t.set=function(e,n){return void 0===n?t.remove(e):(s.setItem(e,t.serialize(n)),n)},t.get=function(e,n){var r=t.deserialize(s.getItem(e));return void 0===r?n:r},t.remove=function(e){s.removeItem(e)},t.clear=function(){s.clear()},t.getAll=function(){var e={};return t.forEach(function(t,n){e[t]=n}),e},t.forEach=function(e){for(var n=0;n<s.length;n++){var r=s.key(n);e(r,t.get(r))}};else if(n.documentElement.addBehavior){var u,a;try{a=new ActiveXObject("htmlfile"),a.open(),a.write("<"+i+">document.w=window</"+i+'><iframe src="/favicon.ico"></iframe>'),a.close(),u=a.w.frames[0].document,s=u.createElement("div")}catch(f){s=n.createElement("div"),u=n.body}var l=function(e){return function(){var n=Array.prototype.slice.call(arguments,0);n.unshift(s),u.appendChild(s),s.addBehavior("#default#userData"),s.load(r);var i=e.apply(t,n);return u.removeChild(s),i}},c=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");t.set=l(function(e,n,i){return n=h(n),void 0===i?t.remove(n):(e.setAttribute(n,t.serialize(i)),e.save(r),i)}),t.get=l(function(e,n,r){n=h(n);var i=t.deserialize(e.getAttribute(n));return void 0===i?r:i}),t.remove=l(function(e,t){t=h(t),e.removeAttribute(t),e.save(r)}),t.clear=l(function(e){var t=e.XMLDocument.documentElement.attributes;e.load(r);for(var i,n=0;i=t[n];n++)e.removeAttribute(i.name);e.save(r)}),t.getAll=function(e){var n={};return t.forEach(function(e,t){n[e]=t}),n},t.forEach=l(function(e,n){for(var s,r=e.XMLDocument.documentElement.attributes,i=0;s=r[i];++i)n(s.name,t.deserialize(e.getAttribute(s.name)))})}try{var p="__storejs__";t.set(p,p),t.get(p)!=p&&(t.disabled=!0),t.remove(p)}catch(f){t.disabled=!0}t.enabled=!t.disabled,"undefined"!=typeof module&&module.exports&&this.module!==module?module.exports=t:"function"==typeof define&&define.amd?define(t):e.store=t}(Function("return this")())},{}],3:[function(require,module,exports){var Storage,store;store=require("store"),Storage=function(){function Storage(namespace){if(this.namespace=null!=namespace?namespace:"alephbet",!store.enabled)throw"local storage not supported";this.storage=store.get(this.namespace)||{}}return Storage.prototype.set=function(key,value){return this.storage[key]=value,store.set(this.namespace,this.storage),value},Storage.prototype.get=function(key){return this.storage[key]},Storage}(),module.exports=Storage},{store:2}],4:[function(require,module,exports){var Utils,_;_=require("lodash.custom"),Utils=function(){function Utils(){}return Utils.defaults=_.defaults,Utils.keys=_.keys,Utils.set_debug=function(debug){this.debug=debug},Utils.log=function(message){return this.debug?console.log(message):void 0},Utils}(),module.exports=Utils},{"lodash.custom":1}],5:[function(require,module,exports){var AlephBet,Storage,log,storage,utils;utils=require("./utils.js.coffee"),Storage=require("./storage.js.coffee"),AlephBet=function(){function AlephBet(){}return AlephBet.options={debug:!1},AlephBet.GoogleUniversalAnalyticsAdapter=function(){function GoogleUniversalAnalyticsAdapter(){}return GoogleUniversalAnalyticsAdapter.namespace="alephbet",GoogleUniversalAnalyticsAdapter._track=function(category,action,label,value){if(log("Google Universal Analytics track: "+category+", "+action+", "+label+", "+value),"function"!=typeof ga)throw"ga not defined. Please make sure your Universal analytics is set up correctly";return ga("send","event",category,action,label,value)},GoogleUniversalAnalyticsAdapter.onInitialize=function(experiment_name,variant){return GoogleUniversalAnalyticsAdapter._track(GoogleUniversalAnalyticsAdapter.namespace,experiment_name,variant+" | Visitors")},GoogleUniversalAnalyticsAdapter.onEvent=function(experiment_name,variant,event_name){return GoogleUniversalAnalyticsAdapter._track(GoogleUniversalAnalyticsAdapter.namespace,experiment_name,variant+" | "+event_name)},GoogleUniversalAnalyticsAdapter}(),AlephBet.Experiment=function(){function Experiment(options){this.options=null!=options?options:{},utils.defaults(this.options,Experiment._options),_validate.call(this),this.variants=utils.keys(this.options.variants),_run.call(this)}var _force_variant,_run,_validate;return Experiment._options={name:null,variants:null,sample:1,trigger:function(){return!0},tracking_adapter:AlephBet.GoogleUniversalAnalyticsAdapter},Experiment.prototype.run=function(){return log("running with options: "+this.options),_force_variant(),this.apply_variant()},_run=function(){return this.run()},_force_variant=function(){},Experiment.prototype.apply_variant=function(){var ref,variant;if(this.options.trigger()&&(log("trigger set"),this.in_sample()))return log("in sample"),(variant=this.get_stored_variant())?log(variant+" active"):(variant=this.pick_variant(),this.options.tracking_adapter.onInitialize(this.options.name,variant)),null!=(ref=this.options.variants[variant])?ref.activate():void 0},Experiment.prototype.goal=function(goal_name,unique){var variant;return null==unique&&(unique=!0),unique&&storage.get(this.options.name+":"+goal_name)||!(variant=this.get_stored_variant())?void 0:(unique&&storage.set(this.options.name+":"+goal_name,!0),this.options.tracking_adapter.onEvent(this.options.name,variant,goal_name))},Experiment.prototype.get_stored_variant=function(){return storage.get(this.options.name+":variant")},Experiment.prototype.pick_variant=function(){var chosen_partition,partitions,variant;return partitions=1/this.variants.length,chosen_partition=Math.floor(Math.random()/partitions),variant=this.variants[chosen_partition],log(variant+" picked"),storage.set(this.options.name+":variant",variant)},Experiment.prototype.in_sample=function(){var active;return active=storage.get(this.options.name+":in_sample"),"undefined"!=typeof active?active:storage.set(this.options.name+":in_sample",Math.random()<=this.options.sample)},_validate=function(){if(null===this.options.name)throw"an experiment name must be specified";if(null===this.options.variants)throw"variants must be provided";if("function"!=typeof this.options.trigger)throw"trigger must be a function"},Experiment}(),AlephBet}(),log=function(message){return utils.set_debug(AlephBet.options.debug),utils.log(message)},storage=new Storage("alephbet"),module.exports=AlephBet},{"./storage.js.coffee":3,"./utils.js.coffee":4}]},{},[5])(5)});
