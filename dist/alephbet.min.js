!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.AlephBet=f()}}(function(){var define;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var AlephBet,Storage,log,utils,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};utils=require("./utils.js.coffee"),Storage=require("./storage.js.coffee"),AlephBet=function(){function AlephBet(){}return AlephBet.options={debug:!1},AlephBet.GoogleUniversalAnalyticsAdapter=function(){function GoogleUniversalAnalyticsAdapter(){}return GoogleUniversalAnalyticsAdapter.namespace="alephbet",GoogleUniversalAnalyticsAdapter._track=function(category,action,label,value){if(log("Google Universal Analytics track: "+category+", "+action+", "+label+", "+value),"function"!=typeof ga)throw"ga not defined. Please make sure your Universal analytics is set up correctly";return ga("send","event",category,action,label,value)},GoogleUniversalAnalyticsAdapter.experiment_start=function(experiment_name,variant){return GoogleUniversalAnalyticsAdapter._track(GoogleUniversalAnalyticsAdapter.namespace,experiment_name+" | "+variant,"Visitors")},GoogleUniversalAnalyticsAdapter.goal_complete=function(experiment_name,variant,goal){return GoogleUniversalAnalyticsAdapter._track(GoogleUniversalAnalyticsAdapter.namespace,experiment_name+" | "+variant,goal)},GoogleUniversalAnalyticsAdapter}(),AlephBet.LocalStorageAdapter=function(){function LocalStorageAdapter(){}return LocalStorageAdapter.namespace="alephbet",LocalStorageAdapter.set=function(key,value){return new Storage(this.namespace).set(key,value)},LocalStorageAdapter.get=function(key){return new Storage(this.namespace).get(key)},LocalStorageAdapter}(),AlephBet.Experiment=function(){function Experiment(options){this.options=null!=options?options:{},this.add_goals=bind(this.add_goals,this),this.add_goal=bind(this.add_goal,this),utils.defaults(this.options,Experiment._options),_validate.call(this),this.name=this.options.name,this.variants=this.options.variants,this.variant_names=utils.keys(this.variants),_run.call(this)}var _force_variant,_run,_validate;return Experiment._options={name:null,variants:null,sample:1,trigger:function(){return!0},tracking_adapter:AlephBet.GoogleUniversalAnalyticsAdapter,storage_adapter:AlephBet.LocalStorageAdapter},Experiment.prototype.run=function(){return log("running with options: "+JSON.stringify(this.options)),_force_variant(),this.apply_variant()},_run=function(){return this.run()},_force_variant=function(){},Experiment.prototype.apply_variant=function(){var ref,variant;if(this.options.trigger()&&(log("trigger set"),this.in_sample()))return log("in sample"),(variant=this.get_stored_variant())?log(variant+" active"):(variant=this.pick_variant(),this.tracking().experiment_start(this.options.name,variant)),null!=(ref=this.variants[variant])&&ref.activate(this),this.storage().set(this.options.name+":variant",variant)},Experiment.prototype.goal_complete=function(goal_name,props){var variant;return null==props&&(props={}),utils.defaults(props,{unique:!0}),props.unique&&this.storage().get(this.options.name+":"+goal_name)||!(variant=this.get_stored_variant())?void 0:(props.unique&&this.storage().set(this.options.name+":"+goal_name,!0),log("experiment: "+this.options.name+" variant:"+variant+" goal:"+goal_name+" complete"),this.tracking().goal_complete(this.options.name,variant,goal_name))},Experiment.prototype.get_stored_variant=function(){return this.storage().get(this.options.name+":variant")},Experiment.prototype.pick_variant=function(){var chosen_partition,partitions,variant;return partitions=1/this.variant_names.length,chosen_partition=Math.floor(Math.random()/partitions),variant=this.variant_names[chosen_partition],log(variant+" picked"),variant},Experiment.prototype.in_sample=function(){var active;return active=this.storage().get(this.options.name+":in_sample"),"undefined"!=typeof active?active:(active=Math.random()<=this.options.sample,this.storage().set(this.options.name+":in_sample",active),active)},Experiment.prototype.add_goal=function(goal){return goal.add_experiment(this)},Experiment.prototype.add_goals=function(goals){var goal,i,len,results;for(results=[],i=0,len=goals.length;len>i;i++)goal=goals[i],results.push(this.add_goal(goal));return results},Experiment.prototype.storage=function(){return this.options.storage_adapter},Experiment.prototype.tracking=function(){return this.options.tracking_adapter},_validate=function(){if(null===this.options.name)throw"an experiment name must be specified";if(null===this.options.variants)throw"variants must be provided";if("function"!=typeof this.options.trigger)throw"trigger must be a function"},Experiment}(),AlephBet.Goal=function(){function Goal(name,props1){this.name=name,this.props=null!=props1?props1:{},utils.defaults(this.props,{unique:!0}),this.experiments=[]}return Goal.prototype.add_experiment=function(experiment){return this.experiments.push(experiment)},Goal.prototype.add_experiments=function(experiments){var experiment,i,len,results;for(results=[],i=0,len=experiments.length;len>i;i++)experiment=experiments[i],results.push(this.add_experiment(experiment));return results},Goal.prototype.complete=function(){var experiment,i,len,ref,results;for(ref=this.experiments,results=[],i=0,len=ref.length;len>i;i++)experiment=ref[i],results.push(experiment.goal_complete(this.name,this.props));return results},Goal}(),AlephBet}(),log=function(message){return utils.set_debug(AlephBet.options.debug),utils.log(message)},module.exports=AlephBet},{"./storage.js.coffee":4,"./utils.js.coffee":5}],2:[function(require,module,exports){(function(){function t(t){return!!t&&"object"==typeof t}function r(){}function n(t,r){return"function"!=typeof t?g:r===h?t:function(n,e,o,u,c){return t.call(r,n,e,o,u,c)}}function e(t,r){var n=null==t?h:t[r];return s(n)?n:h}function o(t,r){return t="number"==typeof t||d.test(t)?+t:-1,r=null==r?V:r,t>-1&&0==t%1&&r>t}function u(t){return"number"==typeof t&&t>-1&&0==t%1&&V>=t}function c(t){for(var r=y(t),n=r.length,e=n&&t.length,c=!!e&&u(e)&&(G(t)||i(t)||p(t)),l=-1,a=[];++l<n;){var f=r[l];(c&&o(f,e)||N.call(t,f))&&a.push(f)}return a}function l(t,r){if("function"!=typeof t)throw new TypeError(b);return r=M(r===h?t.length-1:+r||0,0),function(){for(var n=arguments,e=-1,o=M(n.length-r,0),u=Array(o);++e<o;)u[e]=n[r+e];switch(r){case 0:return t.call(this,u);case 1:return t.call(this,n[0],u);case 2:return t.call(this,n[0],n[1],u)}for(o=Array(r+1),e=-1;++e<r;)o[e]=n[e];return o[r]=u,t.apply(this,o)}}function i(r){return t(r)&&null!=r&&u(z(r))&&N.call(r,"callee")&&!L.call(r,"callee")}function a(t){return f(t)&&R.call(t)==m}function f(t){var r=typeof t;return!!t&&("object"==r||"function"==r)}function s(r){return null==r?!1:a(r)?T.test(F.call(r)):t(r)&&(w(r)?T:x).test(r)}function p(r){return"string"==typeof r||t(r)&&R.call(r)==O}function y(t){if(null==t)return[];f(t)||(t=Object(t));for(var n=t.length,e=r.support,n=n&&u(n)&&(G(t)||i(t)||p(t))&&n||0,c=t.constructor,l=-1,c=a(c)&&c.prototype||k,s=c===t,y=Array(n),g=n>0,h=e.enumErrorProps&&(t===I||t instanceof Error),b=e.enumPrototypes&&a(t);++l<n;)y[l]=l+"";for(var m in t)b&&"prototype"==m||h&&("message"==m||"name"==m)||g&&o(m,n)||"constructor"==m&&(s||!N.call(t,m))||y.push(m);if(e.nonEnumShadows&&t!==k)for(n=t===C?O:t===I?v:R.call(t),e=_[n]||_[j],n==j&&(c=k),n=S.length;n--;)m=S[n],l=e[m],s&&l||(l?!N.call(t,m):t[m]===c[m])||y.push(m);return y}function g(t){return t}var h,b="Expected a function",v="[object Error]",m="[object Function]",j="[object Object]",O="[object String]",x=/^\[object .+?Constructor\]$/,d=/^\d+$/,S="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),E={"function":!0,object:!0},A=E[typeof exports]&&exports&&!exports.nodeType&&exports,P=(E=E[typeof module]&&module&&!module.nodeType&&module)&&E.exports===A&&A,w=function(){try{Object({toString:0}+"")}catch(t){return function(){return!1}}return function(t){return"function"!=typeof t.toString&&"string"==typeof(t+"")}}(),$=Array.prototype,I=Error.prototype,k=Object.prototype,C=String.prototype,F=Function.prototype.toString,N=k.hasOwnProperty,R=k.toString,T=RegExp("^"+F.call(N).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),L=k.propertyIsEnumerable,B=$.splice,$=e(Array,"isArray"),D=e(Object,"keys"),M=Math.max,V=9007199254740991,_={};_["[object Array]"]=_["[object Date]"]=_["[object Number]"]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},_["[object Boolean]"]=_[O]={constructor:!0,toString:!0,valueOf:!0},_[v]=_[m]=_["[object RegExp]"]={constructor:!0,toString:!0},_[j]={constructor:!0},function(t,r){for(var n=-1,e=t.length;++n<e&&!1!==r(t[n],n,t););return t}(S,function(t){for(var r in _)if(N.call(_,r)){var n=_[r];n[t]=N.call(n,t)}});var q=r.support={};!function(t){function r(){this.x=t}var n={0:t,length:t},e=[];r.prototype={valueOf:t,y:t};for(var o in new r)e.push(o);q.enumErrorProps=L.call(I,"message")||L.call(I,"name"),q.enumPrototypes=L.call(r,"prototype"),q.nonEnumShadows=!/valueOf/.test(e),q.spliceObjects=(B.call(n,0,1),!n[0]),q.unindexedChars="xx"!="x"[0]+Object("x")[0]}(1,0);var z=function(t){return function(n){if(null==n)n=h;else{if(r.support.unindexedChars&&p(n)){for(var e=-1,o=n.length,u=Object(n);++e<o;)u[e]=n.charAt(e);n=u}else n=f(n)?n:Object(n);n=n[t]}return n}}("length"),G=$||function(r){return t(r)&&u(r.length)&&"[object Array]"==R.call(r)},$=function(t){return l(function(r,e){var c=-1,l=null==r?0:e.length,i=l>2?e[l-2]:h,a=l>2?e[2]:h,s=l>1?e[l-1]:h;if("function"==typeof i?(i=n(i,s),l-=2):(i="function"==typeof s?s:h,l-=i?1:0),s=a){var s=e[0],p=e[1];if(f(a)){var y=typeof p;("number"==y?null!=a&&u(z(a))&&o(p,a.length):"string"==y&&p in a)?(a=a[p],s=s===s?s===a:a!==a):s=!1}else s=!1}for(s&&(i=3>l?h:i,l=1);++c<l;)(a=e[c])&&t(r,a,i);return r})}(function(t,r,n){if(n)for(var e=-1,o=J(r),u=o.length;++e<u;){var c=o[e],l=t[c],i=n(l,r[c],c,t,r);(i===i?i===l:l!==l)&&(l!==h||c in t)||(t[c]=i)}else if(null!=r)for(n=J(r),t||(t={}),e=-1,o=n.length;++e<o;)u=n[e],t[u]=r[u];return r=t}),H=function(t,r){return l(function(n){var e=n[0];return null==e?e:(n.push(r),t.apply(h,n))})}($,function(t,r){return t===h?r:t}),J=D?function(t){var n=null==t?h:t.constructor;return"function"==typeof n&&n.prototype===t||("function"==typeof t?r.support.enumPrototypes:null!=t&&u(z(t)))?c(t):f(t)?D(t):[]}:c;r.assign=$,r.defaults=H,r.keys=J,r.keysIn=y,r.restParam=l,r.extend=$,r.identity=g,r.isArguments=i,r.isArray=G,r.isFunction=a,r.isNative=s,r.isObject=f,r.isString=p,r.VERSION="3.10.0",A&&E&&P&&((E.exports=r)._=r)}).call(this)},{}],3:[function(require,module,exports){!function(e){function o(){try{return r in e&&e[r]}catch(t){return!1}}function h(e){return e.replace(/^d/,"___$&").replace(c,"___")}var s,t={},n=e.document,r="localStorage",i="script";if(t.disabled=!1,t.version="1.3.17",t.set=function(e,t){},t.get=function(e,t){},t.has=function(e){return void 0!==t.get(e)},t.remove=function(e){},t.clear=function(){},t.transact=function(e,n,r){null==r&&(r=n,n=null),null==n&&(n={});var i=t.get(e,n);r(i),t.set(e,i)},t.getAll=function(){},t.forEach=function(){},t.serialize=function(e){return JSON.stringify(e)},t.deserialize=function(e){if("string"!=typeof e)return void 0;try{return JSON.parse(e)}catch(t){return e||void 0}},o())s=e[r],t.set=function(e,n){return void 0===n?t.remove(e):(s.setItem(e,t.serialize(n)),n)},t.get=function(e,n){var r=t.deserialize(s.getItem(e));return void 0===r?n:r},t.remove=function(e){s.removeItem(e)},t.clear=function(){s.clear()},t.getAll=function(){var e={};return t.forEach(function(t,n){e[t]=n}),e},t.forEach=function(e){for(var n=0;n<s.length;n++){var r=s.key(n);e(r,t.get(r))}};else if(n.documentElement.addBehavior){var u,a;try{a=new ActiveXObject("htmlfile"),a.open(),a.write("<"+i+">document.w=window</"+i+'><iframe src="/favicon.ico"></iframe>'),a.close(),u=a.w.frames[0].document,s=u.createElement("div")}catch(f){s=n.createElement("div"),u=n.body}var l=function(e){return function(){var n=Array.prototype.slice.call(arguments,0);n.unshift(s),u.appendChild(s),s.addBehavior("#default#userData"),s.load(r);var i=e.apply(t,n);return u.removeChild(s),i}},c=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");t.set=l(function(e,n,i){return n=h(n),void 0===i?t.remove(n):(e.setAttribute(n,t.serialize(i)),e.save(r),i)}),t.get=l(function(e,n,r){n=h(n);var i=t.deserialize(e.getAttribute(n));return void 0===i?r:i}),t.remove=l(function(e,t){t=h(t),e.removeAttribute(t),e.save(r)}),t.clear=l(function(e){var t=e.XMLDocument.documentElement.attributes;e.load(r);for(var i,n=0;i=t[n];n++)e.removeAttribute(i.name);e.save(r)}),t.getAll=function(e){var n={};return t.forEach(function(e,t){n[e]=t}),n},t.forEach=l(function(e,n){for(var s,r=e.XMLDocument.documentElement.attributes,i=0;s=r[i];++i)n(s.name,t.deserialize(e.getAttribute(s.name)))})}try{var p="__storejs__";t.set(p,p),t.get(p)!=p&&(t.disabled=!0),t.remove(p)}catch(f){t.disabled=!0}t.enabled=!t.disabled,"undefined"!=typeof module&&module.exports&&this.module!==module?module.exports=t:"function"==typeof define&&define.amd?define(t):e.store=t}(Function("return this")())},{}],4:[function(require,module,exports){var Storage,store;store=require("store"),Storage=function(){function Storage(namespace){if(this.namespace=null!=namespace?namespace:"alephbet",!store.enabled)throw"local storage not supported";this.storage=store.get(this.namespace)||{}}return Storage.prototype.set=function(key,value){return this.storage[key]=value,store.set(this.namespace,this.storage),value},Storage.prototype.get=function(key){return this.storage[key]},Storage}(),module.exports=Storage},{store:3}],5:[function(require,module,exports){var Utils,_;_=require("lodash.custom"),Utils=function(){function Utils(){}return Utils.defaults=_.defaults,Utils.keys=_.keys,Utils.set_debug=function(debug){this.debug=debug},Utils.log=function(message){return this.debug?console.log(message):void 0},Utils}(),module.exports=Utils},{"lodash.custom":2}]},{},[1])(1)});
