!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.AlephBet=f()}}(function(){var define;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var AlephBet,Storage,log,utils,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};utils=require("./utils.js.coffee"),Storage=require("./storage.js.coffee"),AlephBet=function(){function AlephBet(){}return AlephBet.options={debug:!1},AlephBet.GoogleUniversalAnalyticsAdapter=function(){function GoogleUniversalAnalyticsAdapter(){}return GoogleUniversalAnalyticsAdapter.namespace="alephbet",GoogleUniversalAnalyticsAdapter._track=function(category,action,label,value){if(log("Google Universal Analytics track: "+category+", "+action+", "+label+", "+value),"function"!=typeof ga)throw"ga not defined. Please make sure your Universal analytics is set up correctly";return ga("send","event",category,action,label,value)},GoogleUniversalAnalyticsAdapter.experiment_start=function(experiment_name,variant){return GoogleUniversalAnalyticsAdapter._track(GoogleUniversalAnalyticsAdapter.namespace,experiment_name+" | "+variant,"Visitors")},GoogleUniversalAnalyticsAdapter.goal_complete=function(experiment_name,variant,goal){return GoogleUniversalAnalyticsAdapter._track(GoogleUniversalAnalyticsAdapter.namespace,experiment_name+" | "+variant,goal)},GoogleUniversalAnalyticsAdapter}(),AlephBet.LocalStorageAdapter=function(){function LocalStorageAdapter(){}return LocalStorageAdapter.namespace="alephbet",LocalStorageAdapter.set=function(key,value){return new Storage(this.namespace).set(key,value)},LocalStorageAdapter.get=function(key){return new Storage(this.namespace).get(key)},LocalStorageAdapter}(),AlephBet.Experiment=function(){function Experiment(options){this.options=null!=options?options:{},this.add_goals=bind(this.add_goals,this),this.add_goal=bind(this.add_goal,this),utils.defaults(this.options,Experiment._options),_validate.call(this),this.variants=utils.keys(this.options.variants),_run.call(this)}var _force_variant,_run,_validate;return Experiment._options={name:null,variants:null,sample:1,trigger:function(){return!0},tracking_adapter:AlephBet.GoogleUniversalAnalyticsAdapter,storage_adapter:AlephBet.LocalStorageAdapter},Experiment.prototype.run=function(){return log("running with options: "+JSON.stringify(this.options)),_force_variant(),this.apply_variant()},_run=function(){return this.run()},_force_variant=function(){},Experiment.prototype.apply_variant=function(){var ref,variant;if(this.options.trigger()&&(log("trigger set"),this.in_sample()))return log("in sample"),(variant=this.get_stored_variant())?log(variant+" active"):(variant=this.pick_variant(),this.tracking().experiment_start(this.options.name,variant)),null!=(ref=this.options.variants[variant])&&ref.activate(this),this.storage().set(this.options.name+":variant",variant)},Experiment.prototype.goal_complete=function(goal_name,props){var variant;return null==props&&(props={}),utils.defaults(props,{unique:!0}),props.unique&&this.storage().get(this.options.name+":"+goal_name)||!(variant=this.get_stored_variant())?void 0:(props.unique&&this.storage().set(this.options.name+":"+goal_name,!0),log("experiment: "+this.options.name+" variant:"+variant+" goal:"+goal_name+" complete"),this.tracking().goal_complete(this.options.name,variant,goal_name))},Experiment.prototype.get_stored_variant=function(){return this.storage().get(this.options.name+":variant")},Experiment.prototype.pick_variant=function(){var chosen_partition,partitions,variant;return partitions=1/this.variants.length,chosen_partition=Math.floor(Math.random()/partitions),variant=this.variants[chosen_partition],log(variant+" picked"),variant},Experiment.prototype.in_sample=function(){var active;return active=this.storage().get(this.options.name+":in_sample"),"undefined"!=typeof active?active:(active=Math.random()<=this.options.sample,this.storage().set(this.options.name+":in_sample",active),active)},Experiment.prototype.add_goal=function(goal){return goal.add_experiment(this)},Experiment.prototype.add_goals=function(goals){var goal,i,len,results;for(results=[],i=0,len=goals.length;len>i;i++)goal=goals[i],results.push(this.add_goal(goal));return results},Experiment.prototype.storage=function(){return this.options.storage_adapter},Experiment.prototype.tracking=function(){return this.options.tracking_adapter},_validate=function(){if(null===this.options.name)throw"an experiment name must be specified";if(null===this.options.variants)throw"variants must be provided";if("function"!=typeof this.options.trigger)throw"trigger must be a function"},Experiment}(),AlephBet.Goal=function(){function Goal(name,props1){this.name=name,this.props=null!=props1?props1:{},utils.defaults(this.props,{unique:!0}),this.experiments=[]}return Goal.prototype.add_experiment=function(experiment){return this.experiments.push(experiment)},Goal.prototype.add_experiments=function(experiments){var experiment,i,len,results;for(results=[],i=0,len=experiments.length;len>i;i++)experiment=experiments[i],results.push(this.add_experiment(experiment));return results},Goal.prototype.complete=function(){var experiment,i,len,ref,results;for(ref=this.experiments,results=[],i=0,len=ref.length;len>i;i++)experiment=ref[i],results.push(experiment.goal_complete(this.name,this.props));return results},Goal}(),AlephBet}(),log=function(message){return utils.set_debug(AlephBet.options.debug),utils.log(message)},module.exports=AlephBet},{"./storage.js.coffee":4,"./utils.js.coffee":5}],2:[function(require,module,exports){(function(){function t(t){return!!t&&"object"==typeof t}function r(){}function n(t,r){for(var n=-1,e=t.length;++n<e&&r(t[n],n,t)!==!1;);return t}function e(t,r){return t===A?r:t}function o(t,r,n){for(var e=-1,o=pt(r),u=o.length;++e<u;){var c=o[e],i=t[c],a=n(i,r[c],c,t,r);(a===a?a===i:i!==i)&&(i!==A||c in t)||(t[c]=a)}return t}function u(t,r){return null==r?t:c(r,pt(r),t)}function c(t,r,n){n||(n={});for(var e=-1,o=r.length;++e<o;){var u=r[e];n[u]=t[u]}return n}function i(t){return function(r){return null==r?A:b(r)[t]}}function a(t,r,n){if("function"!=typeof t)return w;if(r===A)return t;switch(n){case 1:return function(n){return t.call(r,n)};case 3:return function(n,e,o){return t.call(r,n,e,o)};case 4:return function(n,e,o,u){return t.call(r,n,e,o,u)};case 5:return function(n,e,o,u,c){return t.call(r,n,e,o,u,c)}}return function(){return t.apply(r,arguments)}}function l(t){return m(function(r,n){var e=-1,o=null==r?0:n.length,u=o>2?n[o-2]:A,c=o>2?n[2]:A,i=o>1?n[o-1]:A;for("function"==typeof u?(u=a(u,i,5),o-=2):(u="function"==typeof i?i:A,o-=u?1:0),c&&g(n[0],n[1],c)&&(u=3>o?A:u,o=1);++e<o;){var l=n[e];l&&t(r,l,u)}return r})}function f(t,r){return m(function(n){var e=n[0];return null==e?e:(n.push(r),t.apply(A,n))})}function s(t,r){var n=null==t?A:t[r];return d(n)?n:A}function p(t){return null!=t&&h(at(t))}function y(t,r){return t="number"==typeof t||M.test(t)?+t:-1,r=null==r?ut:r,t>-1&&t%1==0&&r>t}function g(t,r,n){if(!x(n))return!1;var e=typeof r;if("number"==e?p(n)&&y(r,n.length):"string"==e&&r in n){var o=n[r];return t===t?t===o:o!==o}return!1}function h(t){return"number"==typeof t&&t>-1&&t%1==0&&ut>=t}function v(t){for(var r=E(t),n=r.length,e=n&&t.length,o=!!e&&h(e)&&(lt(t)||j(t)||S(t)),u=-1,c=[];++u<n;){var i=r[u];(o&&y(i,e)||X.call(t,i))&&c.push(i)}return c}function b(t){if(r.support.unindexedChars&&S(t)){for(var n=-1,e=t.length,o=Object(t);++n<e;)o[n]=t.charAt(n);return o}return x(t)?t:Object(t)}function m(t,r){if("function"!=typeof t)throw new TypeError($);return r=ot(r===A?t.length-1:+r||0,0),function(){for(var n=arguments,e=-1,o=ot(n.length-r,0),u=Array(o);++e<o;)u[e]=n[r+e];switch(r){case 0:return t.call(this,u);case 1:return t.call(this,n[0],u);case 2:return t.call(this,n[0],n[1],u)}var c=Array(r+1);for(e=-1;++e<r;)c[e]=n[e];return c[r]=u,t.apply(this,c)}}function j(r){return t(r)&&p(r)&&X.call(r,"callee")&&!tt.call(r,"callee")}function O(t){return x(t)&&Y.call(t)==N}function x(t){var r=typeof t;return!!t&&("object"==r||"function"==r)}function d(r){return null==r?!1:O(r)?Z.test(W.call(r)):t(r)&&(H(r)?Z:D).test(r)}function S(r){return"string"==typeof r||t(r)&&Y.call(r)==B}function E(t){if(null==t)return[];x(t)||(t=Object(t));var n=t.length,e=r.support;n=n&&h(n)&&(lt(t)||j(t)||S(t))&&n||0;for(var o=t.constructor,u=-1,c=O(o)&&o.prototype||Q,i=c===t,a=Array(n),l=n>0,f=e.enumErrorProps&&(t===K||t instanceof Error),s=e.enumPrototypes&&O(t);++u<n;)a[u]=u+"";for(var p in t)s&&"prototype"==p||f&&("message"==p||"name"==p)||l&&y(p,n)||"constructor"==p&&(i||!X.call(t,p))||a.push(p);if(e.nonEnumShadows&&t!==Q){var g=t===U?B:t===K?F:Y.call(t),v=ct[g]||ct[T];for(g==T&&(c=Q),n=V.length;n--;){p=V[n];var b=v[p];i&&b||(b?!X.call(t,p):t[p]===c[p])||a.push(p)}}return a}function w(t){return t}var A,P="3.10.0",$="Expected a function",I="[object Array]",k="[object Boolean]",C="[object Date]",F="[object Error]",N="[object Function]",R="[object Number]",T="[object Object]",L="[object RegExp]",B="[object String]",D=/^\[object .+?Constructor\]$/,M=/^\d+$/,V=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],_={"function":!0,object:!0},q=_[typeof exports]&&exports&&!exports.nodeType&&exports,z=_[typeof module]&&module&&!module.nodeType&&module,G=z&&z.exports===q&&q,H=function(){try{Object({toString:0}+"")}catch(t){return function(){return!1}}return function(t){return"function"!=typeof t.toString&&"string"==typeof(t+"")}}(),J=Array.prototype,K=Error.prototype,Q=Object.prototype,U=String.prototype,W=Function.prototype.toString,X=Q.hasOwnProperty,Y=Q.toString,Z=RegExp("^"+W.call(X).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),tt=Q.propertyIsEnumerable,rt=J.splice,nt=s(Array,"isArray"),et=s(Object,"keys"),ot=Math.max,ut=9007199254740991,ct={};ct[I]=ct[C]=ct[R]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},ct[k]=ct[B]={constructor:!0,toString:!0,valueOf:!0},ct[F]=ct[N]=ct[L]={constructor:!0,toString:!0},ct[T]={constructor:!0},n(V,function(t){for(var r in ct)if(X.call(ct,r)){var n=ct[r];n[t]=X.call(n,t)}});var it=r.support={};!function(t){var r=function(){this.x=t},n={0:t,length:t},e=[];r.prototype={valueOf:t,y:t};for(var o in new r)e.push(o);it.enumErrorProps=tt.call(K,"message")||tt.call(K,"name"),it.enumPrototypes=tt.call(r,"prototype"),it.nonEnumShadows=!/valueOf/.test(e),it.spliceObjects=(rt.call(n,0,1),!n[0]),it.unindexedChars="x"[0]+Object("x")[0]!="xx"}(1,0);var at=i("length"),lt=nt||function(r){return t(r)&&h(r.length)&&Y.call(r)==I},ft=l(function(t,r,n){return n?o(t,r,n):u(t,r)}),st=f(ft,e),pt=et?function(t){var n=null==t?A:t.constructor;return"function"==typeof n&&n.prototype===t||("function"==typeof t?r.support.enumPrototypes:p(t))?v(t):x(t)?et(t):[]}:v;r.assign=ft,r.defaults=st,r.keys=pt,r.keysIn=E,r.restParam=m,r.extend=ft,r.identity=w,r.isArguments=j,r.isArray=lt,r.isFunction=O,r.isNative=d,r.isObject=x,r.isString=S,r.VERSION=P,q&&z&&G&&((z.exports=r)._=r)}).call(this)},{}],3:[function(require,module,exports){!function(e){function o(){try{return r in e&&e[r]}catch(t){return!1}}function h(e){return e.replace(/^d/,"___$&").replace(c,"___")}var s,t={},n=e.document,r="localStorage",i="script";if(t.disabled=!1,t.version="1.3.17",t.set=function(e,t){},t.get=function(e,t){},t.has=function(e){return void 0!==t.get(e)},t.remove=function(e){},t.clear=function(){},t.transact=function(e,n,r){null==r&&(r=n,n=null),null==n&&(n={});var i=t.get(e,n);r(i),t.set(e,i)},t.getAll=function(){},t.forEach=function(){},t.serialize=function(e){return JSON.stringify(e)},t.deserialize=function(e){if("string"!=typeof e)return void 0;try{return JSON.parse(e)}catch(t){return e||void 0}},o())s=e[r],t.set=function(e,n){return void 0===n?t.remove(e):(s.setItem(e,t.serialize(n)),n)},t.get=function(e,n){var r=t.deserialize(s.getItem(e));return void 0===r?n:r},t.remove=function(e){s.removeItem(e)},t.clear=function(){s.clear()},t.getAll=function(){var e={};return t.forEach(function(t,n){e[t]=n}),e},t.forEach=function(e){for(var n=0;n<s.length;n++){var r=s.key(n);e(r,t.get(r))}};else if(n.documentElement.addBehavior){var u,a;try{a=new ActiveXObject("htmlfile"),a.open(),a.write("<"+i+">document.w=window</"+i+'><iframe src="/favicon.ico"></iframe>'),a.close(),u=a.w.frames[0].document,s=u.createElement("div")}catch(f){s=n.createElement("div"),u=n.body}var l=function(e){return function(){var n=Array.prototype.slice.call(arguments,0);n.unshift(s),u.appendChild(s),s.addBehavior("#default#userData"),s.load(r);var i=e.apply(t,n);return u.removeChild(s),i}},c=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");t.set=l(function(e,n,i){return n=h(n),void 0===i?t.remove(n):(e.setAttribute(n,t.serialize(i)),e.save(r),i)}),t.get=l(function(e,n,r){n=h(n);var i=t.deserialize(e.getAttribute(n));return void 0===i?r:i}),t.remove=l(function(e,t){t=h(t),e.removeAttribute(t),e.save(r)}),t.clear=l(function(e){var t=e.XMLDocument.documentElement.attributes;e.load(r);for(var i,n=0;i=t[n];n++)e.removeAttribute(i.name);e.save(r)}),t.getAll=function(e){var n={};return t.forEach(function(e,t){n[e]=t}),n},t.forEach=l(function(e,n){for(var s,r=e.XMLDocument.documentElement.attributes,i=0;s=r[i];++i)n(s.name,t.deserialize(e.getAttribute(s.name)))})}try{var p="__storejs__";t.set(p,p),t.get(p)!=p&&(t.disabled=!0),t.remove(p)}catch(f){t.disabled=!0}t.enabled=!t.disabled,"undefined"!=typeof module&&module.exports&&this.module!==module?module.exports=t:"function"==typeof define&&define.amd?define(t):e.store=t}(Function("return this")())},{}],4:[function(require,module,exports){var Storage,store;store=require("store"),Storage=function(){function Storage(namespace){if(this.namespace=null!=namespace?namespace:"alephbet",!store.enabled)throw"local storage not supported";this.storage=store.get(this.namespace)||{}}return Storage.prototype.set=function(key,value){return this.storage[key]=value,store.set(this.namespace,this.storage),value},Storage.prototype.get=function(key){return this.storage[key]},Storage}(),module.exports=Storage},{store:3}],5:[function(require,module,exports){var Utils,_;_=require("lodash.custom"),Utils=function(){function Utils(){}return Utils.defaults=_.defaults,Utils.keys=_.keys,Utils.set_debug=function(debug){this.debug=debug},Utils.log=function(message){return this.debug?console.log(message):void 0},Utils}(),module.exports=Utils},{"lodash.custom":2}]},{},[1])(1)});
