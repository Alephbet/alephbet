!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.AlephBet=f()}}(function(){var define;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){(function(global){(function(){function t(t){return"function"==typeof t||!1}function n(t){return!!t&&"object"==typeof t}function r(){}function e(t,n){return t===j?n:t}function o(t,n){return"function"!=typeof t?v:n===j?t:function(r,e,o,u,c){return t.call(n,r,e,o,u,c)}}function u(t,n){var r=null==t?j:t[n];return y(r)?r:j}function c(t){return null!=t&&i(W(t))}function l(t,n){return t="number"==typeof t||$.test(t)?+t:-1,n=null==n?J:n,t>-1&&0==t%1&&n>t}function i(t){return"number"==typeof t&&t>-1&&0==t%1&&J>=t}function a(t){for(var n=h(t),r=n.length,e=r&&t.length,o=!!e&&i(e)&&(X(t)||s(t)||g(t)),u=-1,c=[];++u<r;){var a=n[u];(o&&l(a,e)||U.call(t,a))&&c.push(a)}return c}function f(t,n){if("function"!=typeof t)throw new TypeError(m);return n=H(n===j?t.length-1:+n||0,0),function(){for(var r=arguments,e=-1,o=H(r.length-n,0),u=Array(o);++e<o;)u[e]=r[n+e];switch(n){case 0:return t.call(this,u);case 1:return t.call(this,r[0],u);case 2:return t.call(this,r[0],r[1],u)}for(o=Array(n+1),e=-1;++e<n;)o[e]=r[e];return o[n]=u,t.apply(this,o)}}function s(t){return n(t)&&c(t)&&V.call(t)==O}function p(t){var n=typeof t;return!!t&&("object"==n||"function"==n)}function y(t){return null==t?!1:V.call(t)==x?_.test(M.call(t)):n(t)&&(N(t)?_:P).test(t)}function g(t){return"string"==typeof t||n(t)&&V.call(t)==E}function h(t){if(null==t)return[];p(t)||(t=Object(t));for(var n=t.length,e=r.support,n=n&&i(n)&&(X(t)||s(t)||g(t))&&n||0,o=t.constructor,u=-1,o=Y(o)&&o.prototype||B,c=o===t,a=Array(n),f=n>0,y=e.enumErrorProps&&(t===L||t instanceof Error),h=e.enumPrototypes&&Y(t);++u<n;)a[u]=u+"";for(var b in t)h&&"prototype"==b||y&&("message"==b||"name"==b)||f&&l(b,n)||"constructor"==b&&(c||!U.call(t,b))||a.push(b);if(e.nonEnumShadows&&t!==B)for(n=t===D?E:t===L?d:V.call(t),e=K[n]||K[w],n==w&&(o=B),n=R.length;n--;)b=R[n],u=e[b],c&&u||(u?!U.call(t,b):t[b]===o[b])||a.push(b);return a}function b(t){return(t="string"==typeof t?t:null==t?"":t+"")&&A.test(t)?t.replace(S,"\\$&"):t}function v(t){return t}var j,m="Expected a function",O="[object Arguments]",d="[object Error]",x="[object Function]",w="[object Object]",E="[object String]",S=/[.*+?^${}()|[\]\/\\]/g,A=RegExp(S.source),P=/^\[object .+?Constructor\]$/,$=/^\d+$/,R="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),T={"function":!0,object:!0},I=T[typeof exports]&&exports&&!exports.nodeType&&exports,k=T[typeof module]&&module&&!module.nodeType&&module,C=T[typeof self]&&self&&self.Object&&self,F=T[typeof window]&&window&&window.Object&&window,T=k&&k.exports===I&&I,C=I&&k&&"object"==typeof global&&global&&global.Object&&global||F!==(this&&this.window)&&F||C||this,N=function(){try{Object({toString:0}+"")}catch(t){return function(){return!1}}return function(t){return"function"!=typeof t.toString&&"string"==typeof(t+"")}}(),F=Array.prototype,L=Error.prototype,B=Object.prototype,D=String.prototype,M=Function.prototype.toString,U=B.hasOwnProperty,V=B.toString,_=RegExp("^"+b(M.call(U)).replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),q=B.propertyIsEnumerable,z=F.splice,C=u(C,"Uint8Array"),F=u(Array,"isArray"),G=u(Object,"keys"),H=Math.max,J=9007199254740991,K={};K["[object Array]"]=K["[object Date]"]=K["[object Number]"]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},K["[object Boolean]"]=K[E]={constructor:!0,toString:!0,valueOf:!0},K[d]=K[x]=K["[object RegExp]"]={constructor:!0,toString:!0},K[w]={constructor:!0},function(t,n){for(var r=-1,e=t.length;++r<e&&!1!==n(t[r],r,t););return t}(R,function(t){for(var n in K)if(U.call(K,n)){var r=K[n];r[t]=U.call(r,t)}});var Q=r.support={};!function(t){function n(){this.x=t}var r={0:t,length:t},e=[];n.prototype={valueOf:t,y:t};for(var o in new n)e.push(o);Q.argsTag=V.call(arguments)==O,Q.enumErrorProps=q.call(L,"message")||q.call(L,"name"),Q.enumPrototypes=q.call(n,"prototype"),Q.nonEnumShadows=!/valueOf/.test(e),Q.spliceObjects=(z.call(r,0,1),!r[0]),Q.unindexedChars="xx"!="x"[0]+Object("x")[0]}(1,0);var W=function(t){return function(n){if(null==n)n=j;else{if(r.support.unindexedChars&&g(n)){for(var e=-1,o=n.length,u=Object(n);++e<o;)u[e]=n.charAt(e);n=u}else n=p(n)?n:Object(n);n=n[t]}return n}}("length");Q.argsTag||(s=function(t){return n(t)&&c(t)&&U.call(t,"callee")&&!q.call(t,"callee")});var X=F||function(t){return n(t)&&i(t.length)&&"[object Array]"==V.call(t)},Y=t(/x/)||C&&!t(C)?function(t){return V.call(t)==x}:t,Z=function(t){return f(function(n,r){var e=-1,u=null==n?0:r.length,i=u>2?r[u-2]:j,a=u>2?r[2]:j,f=u>1?r[u-1]:j;if("function"==typeof i?(i=o(i,f),u-=2):(i="function"==typeof f?f:j,u-=i?1:0),f=a){var f=r[0],s=r[1];if(p(a)){var y=typeof s;("number"==y?c(a)&&l(s,a.length):"string"==y&&s in a)?(a=a[s],f=f===f?f===a:a!==a):f=!1}else f=!1}for(f&&(i=3>u?j:i,u=1);++e<u;)(a=r[e])&&t(n,a,i);return n})}(function(t,n,r){if(r)for(var e=-1,o=tt(n),u=o.length;++e<u;){var c=o[e],l=t[c],i=r(l,n[c],c,t,n);(i===i?i===l:l!==l)&&(l!==j||c in t)||(t[c]=i)}else if(null!=n)for(r=tt(n),t||(t={}),e=-1,o=r.length;++e<o;)u=r[e],t[u]=n[u];return n=t}),C=f(function(t){var n=t[0];return null==n?n:(t.push(e),Z.apply(j,t))}),tt=G?function(t){var n=null==t?null:t.constructor;return"function"==typeof n&&n.prototype===t||("function"==typeof t?r.support.enumPrototypes:c(t))?a(t):p(t)?G(t):[]}:a;r.assign=Z,r.defaults=C,r.keys=tt,r.keysIn=h,r.restParam=f,r.extend=Z,r.escapeRegExp=b,r.identity=v,r.isArguments=s,r.isArray=X,r.isFunction=Y,r.isNative=y,r.isObject=p,r.isString=g,r.VERSION="3.9.3",I&&k&&T&&((k.exports=r)._=r)}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(require,module,exports){!function(e){function o(){try{return r in e&&e[r]}catch(t){return!1}}function h(e){return e.replace(/^d/,"___$&").replace(c,"___")}var s,t={},n=e.document,r="localStorage",i="script";if(t.disabled=!1,t.version="1.3.17",t.set=function(e,t){},t.get=function(e,t){},t.has=function(e){return void 0!==t.get(e)},t.remove=function(e){},t.clear=function(){},t.transact=function(e,n,r){null==r&&(r=n,n=null),null==n&&(n={});var i=t.get(e,n);r(i),t.set(e,i)},t.getAll=function(){},t.forEach=function(){},t.serialize=function(e){return JSON.stringify(e)},t.deserialize=function(e){if("string"!=typeof e)return void 0;try{return JSON.parse(e)}catch(t){return e||void 0}},o())s=e[r],t.set=function(e,n){return void 0===n?t.remove(e):(s.setItem(e,t.serialize(n)),n)},t.get=function(e,n){var r=t.deserialize(s.getItem(e));return void 0===r?n:r},t.remove=function(e){s.removeItem(e)},t.clear=function(){s.clear()},t.getAll=function(){var e={};return t.forEach(function(t,n){e[t]=n}),e},t.forEach=function(e){for(var n=0;n<s.length;n++){var r=s.key(n);e(r,t.get(r))}};else if(n.documentElement.addBehavior){var u,a;try{a=new ActiveXObject("htmlfile"),a.open(),a.write("<"+i+">document.w=window</"+i+'><iframe src="/favicon.ico"></iframe>'),a.close(),u=a.w.frames[0].document,s=u.createElement("div")}catch(f){s=n.createElement("div"),u=n.body}var l=function(e){return function(){var n=Array.prototype.slice.call(arguments,0);n.unshift(s),u.appendChild(s),s.addBehavior("#default#userData"),s.load(r);var i=e.apply(t,n);return u.removeChild(s),i}},c=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");t.set=l(function(e,n,i){return n=h(n),void 0===i?t.remove(n):(e.setAttribute(n,t.serialize(i)),e.save(r),i)}),t.get=l(function(e,n,r){n=h(n);var i=t.deserialize(e.getAttribute(n));return void 0===i?r:i}),t.remove=l(function(e,t){t=h(t),e.removeAttribute(t),e.save(r)}),t.clear=l(function(e){var t=e.XMLDocument.documentElement.attributes;e.load(r);for(var i,n=0;i=t[n];n++)e.removeAttribute(i.name);e.save(r)}),t.getAll=function(e){var n={};return t.forEach(function(e,t){n[e]=t}),n},t.forEach=l(function(e,n){for(var s,r=e.XMLDocument.documentElement.attributes,i=0;s=r[i];++i)n(s.name,t.deserialize(e.getAttribute(s.name)))})}try{var p="__storejs__";t.set(p,p),t.get(p)!=p&&(t.disabled=!0),t.remove(p)}catch(f){t.disabled=!0}t.enabled=!t.disabled,"undefined"!=typeof module&&module.exports&&this.module!==module?module.exports=t:"function"==typeof define&&define.amd?define(t):e.store=t}(Function("return this")())},{}],3:[function(require,module,exports){var Storage,store;store=require("store"),Storage=function(){function Storage(namespace){if(this.namespace=null!=namespace?namespace:"alephbet",!store.enabled)throw"local storage not supported";this.storage=store.get(this.namespace)||{}}return Storage.prototype.set=function(key,value){return this.storage[key]=value,store.set(this.namespace,this.storage),value},Storage.prototype.get=function(key){return this.storage[key]},Storage}(),module.exports=Storage},{store:2}],4:[function(require,module,exports){var Utils,_;_=require("lodash.custom"),Utils=function(){function Utils(){}return Utils.defaults=_.defaults,Utils.keys=_.keys,Utils.set_debug=function(debug){this.debug=debug},Utils.log=function(message){return this.debug?console.log(message):void 0},Utils}(),module.exports=Utils},{"lodash.custom":1}],5:[function(require,module,exports){var AlephBet,Storage,log,utils,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};utils=require("./utils.js.coffee"),Storage=require("./storage.js.coffee"),AlephBet=function(){function AlephBet(){}return AlephBet.options={debug:!1},AlephBet.GoogleUniversalAnalyticsAdapter=function(){function GoogleUniversalAnalyticsAdapter(){}return GoogleUniversalAnalyticsAdapter.namespace="alephbet",GoogleUniversalAnalyticsAdapter._track=function(category,action,label,value){if(log("Google Universal Analytics track: "+category+", "+action+", "+label+", "+value),"function"!=typeof ga)throw"ga not defined. Please make sure your Universal analytics is set up correctly";return ga("send","event",category,action,label,value)},GoogleUniversalAnalyticsAdapter.experiment_start=function(experiment_name,variant){return GoogleUniversalAnalyticsAdapter._track(GoogleUniversalAnalyticsAdapter.namespace,experiment_name+" | "+variant,"Visitors")},GoogleUniversalAnalyticsAdapter.goal_complete=function(experiment_name,variant,goal){return GoogleUniversalAnalyticsAdapter._track(GoogleUniversalAnalyticsAdapter.namespace,experiment_name+" | "+variant,goal)},GoogleUniversalAnalyticsAdapter}(),AlephBet.LocalStorageAdapter=function(){function LocalStorageAdapter(){}return LocalStorageAdapter.namespace="alephbet",LocalStorageAdapter.set=function(key,value){return new Storage(this.namespace).set(key,value)},LocalStorageAdapter.get=function(key){return new Storage(this.namespace).get(key)},LocalStorageAdapter}(),AlephBet.Experiment=function(){function Experiment(options){this.options=null!=options?options:{},this.add_goal=bind(this.add_goal,this),utils.defaults(this.options,Experiment._options),_validate.call(this),this.variants=utils.keys(this.options.variants),_run.call(this)}var _force_variant,_run,_validate;return Experiment._options={name:null,variants:null,sample:1,trigger:function(){return!0},tracking_adapter:AlephBet.GoogleUniversalAnalyticsAdapter,storage_adapter:AlephBet.LocalStorageAdapter},Experiment.prototype.run=function(){return log("running with options: "+JSON.stringify(this.options)),_force_variant(),this.apply_variant()},_run=function(){return this.run()},_force_variant=function(){},Experiment.prototype.apply_variant=function(){var ref,variant;if(this.options.trigger()&&(log("trigger set"),this.in_sample()))return log("in sample"),(variant=this.get_stored_variant())?log(variant+" active"):(variant=this.pick_variant(),this.tracking().experiment_start(this.options.name,variant)),null!=(ref=this.options.variants[variant])?ref.activate():void 0},Experiment.prototype.goal_complete=function(goal_name,props){var variant;return null==props&&(props={}),utils.defaults(props,{unique:!0}),props.unique&&this.storage().get(this.options.name+":"+goal_name)||!(variant=this.get_stored_variant())?void 0:(props.unique&&this.storage().set(this.options.name+":"+goal_name,!0),log("experiment: "+this.options.name+" variant:"+variant+" goal:"+goal_name+" complete"),this.tracking().goal_complete(this.options.name,variant,goal_name))},Experiment.prototype.get_stored_variant=function(){return this.storage().get(this.options.name+":variant")},Experiment.prototype.pick_variant=function(){var chosen_partition,partitions,variant;return partitions=1/this.variants.length,chosen_partition=Math.floor(Math.random()/partitions),variant=this.variants[chosen_partition],log(variant+" picked"),this.storage().set(this.options.name+":variant",variant)},Experiment.prototype.in_sample=function(){var active;return active=this.storage().get(this.options.name+":in_sample"),"undefined"!=typeof active?active:this.storage().set(this.options.name+":in_sample",Math.random()<=this.options.sample)},Experiment.prototype.add_goal=function(goal){return goal.add_experiment(this)},Experiment.prototype.storage=function(){return this.options.storage_adapter},Experiment.prototype.tracking=function(){return this.options.tracking_adapter},_validate=function(){if(null===this.options.name)throw"an experiment name must be specified";if(null===this.options.variants)throw"variants must be provided";if("function"!=typeof this.options.trigger)throw"trigger must be a function"},Experiment}(),AlephBet.Goal=function(){function Goal(name,props1){this.name=name,this.props=null!=props1?props1:{},utils.defaults(this.props,{unique:!0})}return Goal.prototype.add_experiment=function(experiment){return this.experiments||(this.experiments=[]),this.experiments.push(experiment)},Goal.prototype.complete=function(){var experiment,i,len,ref,results;for(ref=this.experiments,results=[],i=0,len=ref.length;len>i;i++)experiment=ref[i],results.push(experiment.goal_complete(this.name,this.props));return results},Goal}(),AlephBet}(),log=function(message){return utils.set_debug(AlephBet.options.debug),utils.log(message)},module.exports=AlephBet},{"./storage.js.coffee":3,"./utils.js.coffee":4}]},{},[5])(5)});
